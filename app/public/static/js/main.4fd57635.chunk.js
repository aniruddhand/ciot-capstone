(this["webpackJsonprouter-tutorial"]=this["webpackJsonprouter-tutorial"]||[]).push([[0],{303:function(e,t,s){"use strict";s.r(t);var c=s(0),a=s.n(c),n=s(76),r=s.n(n),l=s(8),i=s(29),d=s(11),j=s(1),o=Object(c.createContext)();function m(){return Object(c.useContext)(o)}function b(e){var t=e.children,s=Object(c.useState)(),a=Object(d.a)(s,2),n=a[0],r=a[1];return Object(j.jsx)(o.Provider,{value:{user:n,signIn:function(e,t,s){var c=JSON.stringify({email:e,pin:t}),a=new Request("api/login",{method:"POST",body:c,headers:{"Content-Type":"application/json"}});fetch(a).then((function(e){e.status>=200&&e.status<500?e.json().then((function(t){r(e.ok?t:null),s(e.ok?null:t)}),(function(e){console.log(e)})).catch((function(e){console.log(e)})):e.text().then((function(e){r(null),s()}))}))},signOut:function(e,t){var s=new Request("/api/logout",{method:"POST",body:JSON.stringify({email:e})});fetch(s).then((function(e){r(null),t()}))}},children:t})}function h(){var e,t=m(),s=Object(l.h)();return Object(j.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("h1",{children:Object(j.jsx)(i.b,{className:"navbar-brand",to:"/dashboard/summary",children:"Smart Water Level Controller"})}),Object(j.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:[Object(j.jsx)("ul",{className:"d-flex navbar-nav me-auto mb-2 mb-lg-0"}),Object(j.jsx)("div",{className:"nav-item dropdown d-flex",children:Object(j.jsxs)("div",{className:"nav-item dropdown",children:[Object(j.jsx)("button",{className:"btn btn-secondary btn-sm dropdown-toggle",id:"navbarDropdown","data-bs-toggle":"dropdown","aria-expanded":"false",children:null===(e=t.user)||void 0===e?void 0:e.fullName}),Object(j.jsx)("ul",{className:"dropdown-menu","aria-labelledby":"navbarDropdown",children:Object(j.jsx)("li",{children:Object(j.jsx)("button",{className:"dropdown-item",onClick:function(){var e;t.signOut(null===(e=t.user)||void 0===e?void 0:e.email,(function(){s("/login",{replace:!0})}))},children:"Logout"})})})]})})]})]})})}function u(){var e=Object(l.g)(),t=Object(l.h)();function s(t){return e.pathname.endsWith(t)?"list-group-item active":"list-group-item"}return Object(c.useEffect)((function(){"/"===e.pathname&&t("/dashboard/summary",{replace:!0})}),[e,t]),Object(j.jsxs)("div",{className:"card shadow",style:{width:"18rem"},children:[Object(j.jsx)("div",{className:"card-header",children:Object(j.jsx)("h5",{className:"card-title",children:"Dashboard"})}),Object(j.jsx)("div",{className:"card-body",children:Object(j.jsxs)("ul",{className:"list-group list-group-flush",children:[Object(j.jsx)(i.b,{to:"/dashboard/summary",className:s("/dashboard/summary"),children:"Summary"}),Object(j.jsx)(i.b,{to:"/dashboard/usage",className:s("/dashboard/usage"),children:"Usage"})]})}),Object(j.jsx)("div",{className:"card-header",style:{borderTop:"1px solid rgba(0,0,0,.125)"},children:Object(j.jsx)("h5",{className:"card-title",style:{marginTop:"10px"},children:"Schedules"})}),Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("ul",{className:"list-group list-group-flush",children:Object(j.jsx)(i.b,{to:"/schedules/current",className:s("/schedules/current"),children:"Water Pump"})})}),Object(j.jsx)("div",{className:"card-header",style:{borderTop:"1px solid rgba(0,0,0,.125)"},children:Object(j.jsx)("h5",{className:"card-title",style:{marginTop:"10px"},children:"Notifications"})}),Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("ul",{className:"list-group list-group-flush",children:Object(j.jsx)(i.b,{to:"/alerts/active",className:s("/alerts/active"),children:"Active"})})})]})}var O=function(){return Object(j.jsxs)("div",{style:{height:"100%"},children:[Object(j.jsx)(h,{}),Object(j.jsx)("div",{className:"container",children:Object(j.jsxs)("div",{className:"row",style:{marginTop:"10px"},children:[Object(j.jsx)("div",{className:"col-3",children:Object(j.jsx)(u,{})}),Object(j.jsx)("div",{className:"col",children:Object(j.jsx)(l.b,{})})]})})]})},x=!1;var f=function(){var e,t,s=Object(l.h)(),a=Object(l.g)(),n=m(),r=Object(c.useState)(!1),i=Object(d.a)(r,2),o=i[0],b=i[1],h=Object(c.useState)(!1),u=Object(d.a)(h,2),O=u[0],f=u[1],p=(null===(e=a.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(c.useEffect)((function(){return n.user||o||x?b(!0):(x=!0,fetch("/api/session").then((function(e){200===e.status?e.json().then((function(e){n.user=e,s("/",{replace:!0})})):b(!0)}))),function(){b(!0)}}),[o,n,s]),o&&!n.user?Object(j.jsx)("div",{className:"container vh-100",children:Object(j.jsxs)("div",{className:"row align-items-center vh-100",children:[Object(j.jsx)("div",{className:"col"}),Object(j.jsx)("div",{className:"col",children:Object(j.jsxs)("form",{onSubmit:function(e){e.preventDefault(),f(!0);var t=new FormData(e.currentTarget),c=t.get("email"),a=t.get("pin");n.signIn(c,a,(function(e){e?(f(!1),console.log(e)):s(p,{replace:!0})}))},children:[Object(j.jsx)("h3",{children:"Sign in"}),Object(j.jsxs)("div",{className:"form-floating mb-3",children:[Object(j.jsx)("input",{name:"email",type:"email",className:"form-control",id:"floatingInput",placeholder:"name@example.com",required:!0}),Object(j.jsx)("label",{htmlFor:"floatingInput",children:"Email address"})]}),Object(j.jsxs)("div",{className:"form-floating",children:[Object(j.jsx)("input",{name:"pin",type:"password",className:"form-control",id:"floatingPassword",placeholder:"Pin",required:!0}),Object(j.jsx)("label",{htmlFor:"floatingPassword",children:"Pin"})]}),Object(j.jsxs)("button",{type:"submit",className:"btn btn-primary",style:{marginTop:"10px"},disabled:O,children:[O&&Object(j.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),O&&" Sign in",!O&&"Sign in"]}),Object(j.jsxs)("div",{className:"form-text",children:["Not registered? ",Object(j.jsx)("a",{href:"/register",className:"link-primary",children:"Register here"})]})]})}),Object(j.jsx)("div",{className:"col"})]})}):Object(j.jsx)("div",{})};function p(e){var t=e.children,s=Object(c.useState)(!1),a=Object(d.a)(s,2),n=a[0],r=a[1],i=m(),o=Object(l.g)();return Object(c.useEffect)((function(){return i.user||n||fetch("/api/session").then((function(e){200===e.status?e.json().then((function(e){i.user=e,r(!0)})):r(!0)})),function(){r(!0)}}),[n,i]),i.user?t:n?Object(j.jsx)(l.a,{to:"/login",state:{from:o}}):Object(j.jsx)("div",{})}var v=s(51),g=s.n(v);function N(){var e=m(),t=Object(c.useState)(),s=Object(d.a)(t,2),a=s[0],n=s[1],r=Object(l.h)();return Object(c.useEffect)((function(){if(!a){var e=sessionStorage.getItem("fleetStatus");e?n(JSON.parse(e)):fetch("/api/status").then((function(e){e.status>=200&&e.status<400?e.json().then((function(e){n(e),sessionStorage.setItem("fleetStatus",JSON.stringify(e))})):e.text().then((function(e){console.log(e)}))}))}}),[a,e,r]),Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Summary"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page a brief summary of various components of the water management system in your apartment."}),!a&&Object(j.jsx)("p",{className:"fw-normal",children:"Please wait while we fetch latest water levels in your aparment..."}),!a&&Object(j.jsx)("div",{className:"d-flex justify-content-center",children:Object(j.jsx)("div",{className:"spinner-border m-5",role:"status",style:{width:"3rem",height:"3rem"}})}),a&&Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0 h-100",children:[Object(j.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center",children:Object(j.jsx)("i",{className:"bi bi-water",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Overhead Tank"}),Object(j.jsxs)("p",{className:"card-text",children:["The overhead water tank has ",Object(j.jsx)("span",{className:"fw-bold",children:a.wlgw.volume})," liters of water."]}),Object(j.jsx)("p",{className:"card-text",children:Object(j.jsxs)("small",{className:"text-muted",children:["Last updated ",g()(new Date(a.wlgw.timestamp))]})})]})})]})})})}),a&&a.slgw&&Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0 h-100",children:[Object(j.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center",children:Object(j.jsx)("i",{className:"bi bi-moisture",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Sump Tank"}),Object(j.jsxs)("p",{className:"card-text",children:["The sump tank has ",Object(j.jsx)("span",{className:"fw-bold",children:a.slgw.volume})," liters of water."]}),Object(j.jsx)("p",{className:"card-text",children:Object(j.jsxs)("small",{className:"text-muted",children:["Last updated ",g()(new Date(a.slgw.timestamp))]})})]})})]})})})}),a&&a.pump&&!1]})}var w=s(305),y=s(158),S=s(309),T=s(155),k=s(156),D=s(67);function I(){var e=Object(c.useState)(),t=Object(d.a)(e,2),s=t[0],a=t[1];return Object(c.useEffect)((function(){if(!s){var e=sessionStorage.getItem("fleetUsage");if(e)a(JSON.parse(e));else{var t=JSON.parse(sessionStorage.getItem("fleetStatus")),c=Date.now(),n=new Date(c),r=c-60*n.getHours()*60*1e3-60*n.getMinutes()*1e3-1e3*n.getSeconds(),l=r+828e5+354e4+59e3,i={wlGWThingName:t.wlgw.thingName,slGWThingName:t.slgw.thingName,fromTimestamp:r,toTimestamp:l};fetch("/api/timeseries/usage",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((function(e){if(200===e.status){var t={wlgw:[]};e.json().then((function(e){if(e.wlgw&&e.wlgw.length){var s=0;e.wlgw.forEach((function(e){if(e.volume!==s){var c=new Date(e.timestamp);e.datetime=c.getHours()+":"+c.getMinutes()+" "+(c.getHours()<12?"am":"pm"),t.wlgw.push(e),s=e.volume}}))}a(t),sessionStorage.setItem("fleetUsage",JSON.stringify(t))}))}}))}}}),[s]),Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Today's Usage"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page shows overhead tank's water levels in today's time period."}),!s&&Object(j.jsx)("div",{className:"d-flex justify-content-center",children:Object(j.jsx)("div",{className:"spinner-border m-5",role:"status",style:{width:"3rem",height:"3rem"}})}),s&&Object(j.jsxs)(w.a,{width:900,height:400,data:s.wlgw,children:[Object(j.jsx)(y.a,{type:"monotone",dataKey:"volume",stroke:"#ff7300"}),Object(j.jsx)(S.a,{stroke:"#ccc",strokeDasharray:"5 5"}),Object(j.jsx)(T.a,{dataKey:"datetime"}),Object(j.jsx)(k.a,{}),Object(j.jsx)(D.a,{})]})]})}function J(){var e=Object(c.useState)({startsOn:{minLevel:600},endsOn:{maxLevel:1500},lastUpdatedOn:new Date(1636494845e3)}),t=Object(d.a)(e,1)[0];return Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Water pump schedule"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page shows the current schedule of your water pumping system."}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0",children:[Object(j.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center h-100",children:Object(j.jsx)("i",{className:"bi bi-calendar2-date-fill",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Pump timings"}),"Current schedule of your water pump is as follows:",Object(j.jsx)("p",{}),Object(j.jsx)("h6",{children:"Turns on"}),Object(j.jsxs)("p",{className:"card-text",children:["Whenever water level drops below\xa0",Object(j.jsx)("span",{className:"fw-bold",children:t.startsOn.minLevel})," liters."]}),Object(j.jsx)("h6",{children:"Turns off"}),Object(j.jsxs)("p",{className:"card-text",children:["Whenever water level reaches\xa0",Object(j.jsx)("span",{className:"fw-bold",children:t.endsOn.maxLevel})," liters."]}),Object(j.jsx)("p",{className:"card-text",children:Object(j.jsxs)("small",{className:"text-muted",children:["Updated ",g()(t.lastUpdatedOn)]})})]})})]})})}),Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"d-flex col-8 justify-content-end gx-0",children:Object(j.jsx)("div",{children:Object(j.jsx)("button",{className:"btn btn-primary bg-lt",children:"Change schedule"})})})})]})]})}function P(){return Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Fleet Hub"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page shows current status of your devices."})]})}function W(){var e=Object(c.useState)(),t=Object(d.a)(e,2),s=t[0],a=t[1];return Object(c.useEffect)((function(){if(!s){var e=JSON.parse(sessionStorage.getItem("fleetStatus")),t=encodeURI(e.wlgw.thingName);fetch("/api/alerts?wlGWThingName=".concat(t)).then((function(e){200===e.status&&e.json().then((function(e){e.forEach((function(e){var t=new Date(e.data.fromTimestamp),s=new Date(e.data.toTimestamp),c=t.getHours(),a=t.getMinutes(),n=c>12?" pm":" am",r=s.getHours(),l=s.getMinutes(),i=r>12?" pm":" am";e.data.timeRange="".concat(c,":").concat(a," ").concat(n," to ").concat(r,":").concat(l," ").concat(i)})),a(e)}))}))}}),[s]),Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Active notifications"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page shows recent alerts generated by the water management system."}),!s&&Object(j.jsx)("div",{className:"d-flex justify-content-center",children:Object(j.jsx)("div",{className:"spinner-border m-5",role:"status",style:{width:"3rem",height:"3rem"}})}),s&&Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0 h-100",children:[Object(j.jsx)("div",{className:"col-md-4 bg-warning",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center",children:Object(j.jsx)("i",{className:"bi bi-droplet-half",style:{fontSize:"07rem",color:"red"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Water flowed continuously!"}),Object(j.jsxs)("p",{className:"card-text",children:["Continuous water flow was observed. Water was continuously at the rate of ",Object(j.jsxs)("span",{className:"fw-bold",children:[s[0].data.mean," ltr"]})," per minute between \xa0",Object(j.jsx)("span",{className:"fw-bold",children:s[0].data.timeRange})]})]})})]})})})})]})}r.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(b,{children:Object(j.jsx)(i.a,{children:Object(j.jsxs)(l.e,{children:[Object(j.jsx)(l.c,{path:"/login",element:Object(j.jsx)(f,{})}),Object(j.jsxs)(l.c,{path:"/",element:Object(j.jsx)(p,{children:Object(j.jsx)(O,{})}),children:[Object(j.jsx)(l.c,{path:"/dashboard/summary",element:Object(j.jsx)(p,{children:Object(j.jsx)(N,{})})}),Object(j.jsx)(l.c,{path:"/dashboard/usage",element:Object(j.jsx)(p,{children:Object(j.jsx)(I,{})})}),Object(j.jsx)(l.c,{path:"/schedules/current",element:Object(j.jsx)(p,{children:Object(j.jsx)(J,{})})}),Object(j.jsx)(l.c,{path:"/status/fleet",element:Object(j.jsx)(p,{children:Object(j.jsx)(P,{})})}),Object(j.jsx)(l.c,{path:"/alerts/active",element:Object(j.jsx)(p,{children:Object(j.jsx)(W,{})})})]})]})})})}),document.getElementById("root"))}},[[303,1,2]]]);
//# sourceMappingURL=main.4fd57635.chunk.js.map