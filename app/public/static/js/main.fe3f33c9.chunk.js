(this["webpackJsonprouter-tutorial"]=this["webpackJsonprouter-tutorial"]||[]).push([[0],{15:function(e,t,s){"use strict";s.r(t);var c=s(1),a=s.n(c),n=s(8),r=s.n(n),l=s(2),i=s(5),d=s(3),o=s(0),j=Object(c.createContext)();function b(){return Object(c.useContext)(j)}function h(e){var t=e.children,s=Object(c.useState)(),a=Object(d.a)(s,2),n=a[0],r=a[1];return Object(o.jsx)(j.Provider,{value:{user:n,signIn:function(e,t,s){var c=JSON.stringify({email:e,pin:t}),a=new Request("api/login",{method:"POST",body:c,headers:{"Content-Type":"application/json"}});fetch(a).then((function(e){e.status>=200&&e.status<500?e.json().then((function(t){r(e.ok?t:null),s(e.ok?null:t)}),(function(e){console.log(e)})).catch((function(e){console.log(e)})):e.text().then((function(e){r(null),s()}))}))},signOut:function(e,t){var s=new Request("/api/logout",{method:"POST",body:JSON.stringify({email:e})});fetch(s).then((function(e){r(null),t()}))}},children:t})}function u(){var e,t=b(),s=Object(l.h)();return Object(o.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:Object(o.jsxs)("div",{className:"container",children:[Object(o.jsx)("h1",{children:Object(o.jsx)(i.b,{className:"navbar-brand",to:"/dashboard/summary",children:"Smart Water Level Controller"})}),Object(o.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:[Object(o.jsx)("ul",{className:"d-flex navbar-nav me-auto mb-2 mb-lg-0"}),Object(o.jsx)("div",{className:"nav-item dropdown d-flex",children:Object(o.jsxs)("div",{className:"nav-item dropdown",children:[Object(o.jsx)("button",{className:"btn btn-secondary btn-sm dropdown-toggle",id:"navbarDropdown","data-bs-toggle":"dropdown","aria-expanded":"false",children:null===(e=t.user)||void 0===e?void 0:e.fullName}),Object(o.jsx)("ul",{className:"dropdown-menu","aria-labelledby":"navbarDropdown",children:Object(o.jsx)("li",{children:Object(o.jsx)("button",{className:"dropdown-item",onClick:function(){var e;t.signOut(null===(e=t.user)||void 0===e?void 0:e.email,(function(){s("/login",{replace:!0})}))},children:"Logout"})})})]})})]})]})})}function m(){var e=Object(l.g)(),t=Object(l.h)();function s(t){return e.pathname.endsWith(t)?"list-group-item active":"list-group-item"}return Object(c.useEffect)((function(){"/"===e.pathname&&t("/dashboard/summary",{replace:!0})}),[e,t]),Object(o.jsxs)("div",{className:"card shadow",style:{width:"18rem"},children:[Object(o.jsx)("div",{className:"card-header",children:Object(o.jsx)("h5",{className:"card-title",children:"Dashboard"})}),Object(o.jsx)("div",{className:"card-body",children:Object(o.jsxs)("ul",{className:"list-group list-group-flush",children:[Object(o.jsx)(i.b,{to:"/dashboard/summary",className:s("/dashboard/summary"),children:"Summary"}),Object(o.jsx)(i.b,{to:"/dashboard/usage",className:s("/dashboard/usage"),children:"Usage"})]})}),Object(o.jsx)("div",{className:"card-header",style:{borderTop:"1px solid rgba(0,0,0,.125)"},children:Object(o.jsx)("h5",{className:"card-title",style:{marginTop:"10px"},children:"Schedules"})}),Object(o.jsx)("div",{className:"card-body",children:Object(o.jsx)("ul",{className:"list-group list-group-flush",children:Object(o.jsx)(i.b,{to:"/schedules/current",className:s("/schedules/current"),children:"Today's Schedule"})})}),Object(o.jsx)("div",{className:"card-header",style:{borderTop:"1px solid rgba(0,0,0,.125)"},children:Object(o.jsx)("h5",{className:"card-title",style:{marginTop:"10px"},children:"Notifications"})}),Object(o.jsx)("div",{className:"card-body",children:Object(o.jsx)("ul",{className:"list-group list-group-flush",children:Object(o.jsx)(i.b,{to:"/alerts/active",className:s("/alerts/active"),children:"Active"})})})]})}var O=function(){return Object(o.jsxs)("div",{style:{height:"100%"},children:[Object(o.jsx)(u,{}),Object(o.jsx)("div",{className:"container",children:Object(o.jsxs)("div",{className:"row",style:{marginTop:"10px"},children:[Object(o.jsx)("div",{className:"col-3",children:Object(o.jsx)(m,{})}),Object(o.jsx)("div",{className:"col",children:Object(o.jsx)(l.b,{})})]})})]})},x=!1;var p=function(){var e,t,s=Object(l.h)(),a=Object(l.g)(),n=b(),r=Object(c.useState)(!1),i=Object(d.a)(r,2),j=i[0],h=i[1],u=Object(c.useState)(!1),m=Object(d.a)(u,2),O=m[0],p=m[1],f=(null===(e=a.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(c.useEffect)((function(){return n.user||j||x?h(!0):(x=!0,fetch("/api/session").then((function(e){200===e.status?e.json().then((function(e){n.user=e,s("/",{replace:!0})})):h(!0)}))),function(){h(!0)}}),[j,n,s]),j&&!n.user?Object(o.jsx)("div",{className:"container vh-100",children:Object(o.jsxs)("div",{className:"row align-items-center vh-100",children:[Object(o.jsx)("div",{className:"col"}),Object(o.jsx)("div",{className:"col",children:Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault(),p(!0);var t=new FormData(e.currentTarget),c=t.get("email"),a=t.get("pin");n.signIn(c,a,(function(e){e?(p(!1),console.log(e)):s(f,{replace:!0})}))},children:[Object(o.jsx)("h3",{children:"Sign in"}),Object(o.jsxs)("div",{className:"form-floating mb-3",children:[Object(o.jsx)("input",{name:"email",type:"email",className:"form-control",id:"floatingInput",placeholder:"name@example.com",required:!0}),Object(o.jsx)("label",{htmlFor:"floatingInput",children:"Email address"})]}),Object(o.jsxs)("div",{className:"form-floating",children:[Object(o.jsx)("input",{name:"pin",type:"password",className:"form-control",id:"floatingPassword",placeholder:"Pin",required:!0}),Object(o.jsx)("label",{htmlFor:"floatingPassword",children:"Pin"})]}),Object(o.jsxs)("button",{type:"submit",className:"btn btn-primary",style:{marginTop:"10px"},disabled:O,children:[O&&Object(o.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),O&&" Sign in",!O&&"Sign in"]}),Object(o.jsxs)("div",{className:"form-text",children:["Not registered? ",Object(o.jsx)("a",{href:"/register",className:"link-primary",children:"Register here"})]})]})}),Object(o.jsx)("div",{className:"col"})]})}):Object(o.jsx)("div",{})};function f(e){var t=e.children,s=Object(c.useState)(!1),a=Object(d.a)(s,2),n=a[0],r=a[1],i=b(),j=Object(l.g)();return Object(c.useEffect)((function(){return i.user||n||fetch("/api/session").then((function(e){200===e.status?e.json().then((function(e){i.user=e,r(!0)})):r(!0)})),function(){r(!0)}}),[n,i]),i.user?t:n?Object(o.jsx)(l.a,{to:"/login",state:{from:j}}):Object(o.jsx)("div",{})}var v=s(9),g=s.n(v);function N(){var e=b(),t=Object(c.useState)(),s=Object(d.a)(t,2),a=s[0],n=s[1],r=Object(l.h)();return Object(c.useEffect)((function(){a||fetch("/api/status").then((function(e){e.status>=200&&e.status<400?e.json().then((function(e){n(e)})):e.text().then((function(e){console.log(e)}))}))}),[a,e,r]),Object(o.jsxs)("div",{children:[Object(o.jsx)("h3",{children:"Status"}),Object(o.jsx)("p",{className:"fw-normal",children:"This page shows the current status of the water management system in your apartment."}),!a&&Object(o.jsx)("p",{className:"fw-normal",children:"Please wait while we fetch latest water levels in your aparment..."}),!a&&Object(o.jsx)("div",{className:"d-flex justify-content-center",children:Object(o.jsx)("div",{className:"spinner-border m-5",role:"status",style:{width:"3rem",height:"3rem"}})}),a&&Object(o.jsx)("div",{className:"card mb-3 top-m-5",style:{maxWidth:"540px"},children:Object(o.jsxs)("div",{className:"row g-0",children:[Object(o.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(o.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center",children:Object(o.jsx)("i",{className:"bi bi-water",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(o.jsx)("div",{className:"col-md-8",children:Object(o.jsxs)("div",{className:"card-body",children:[Object(o.jsx)("h5",{className:"card-title",children:"Overhead Tank"}),Object(o.jsxs)("p",{className:"card-text",children:["The overhead water tank has ",Object(o.jsx)("span",{className:"fw-bold",children:a.wlgw.volume})," liters of water."]}),Object(o.jsx)("p",{className:"card-text",children:Object(o.jsxs)("small",{className:"text-muted",children:["Last updated ",g()(new Date(a.wlgw.timestamp))]})})]})})]})})]})}function y(){return Object(o.jsx)("h1",{children:"Usage"})}function w(){return Object(o.jsx)("h1",{children:"Today's schedule"})}function S(){return Object(o.jsx)("h1",{children:"Active notifications"})}r.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(h,{children:Object(o.jsx)(i.a,{children:Object(o.jsxs)(l.e,{children:[Object(o.jsx)(l.c,{path:"/login",element:Object(o.jsx)(p,{})}),Object(o.jsxs)(l.c,{path:"/",element:Object(o.jsx)(f,{children:Object(o.jsx)(O,{})}),children:[Object(o.jsx)(l.c,{path:"/dashboard/summary",element:Object(o.jsx)(f,{children:Object(o.jsx)(N,{})})}),Object(o.jsx)(l.c,{path:"/dashboard/usage",element:Object(o.jsx)(f,{children:Object(o.jsx)(y,{})})}),Object(o.jsx)(l.c,{path:"/schedules/current",element:Object(o.jsx)(f,{children:Object(o.jsx)(w,{})})}),Object(o.jsx)(l.c,{path:"/alerts/active",element:Object(o.jsx)(f,{children:Object(o.jsx)(S,{})})})]})]})})})}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.fe3f33c9.chunk.js.map