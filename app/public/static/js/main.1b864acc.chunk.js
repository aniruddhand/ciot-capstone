(this["webpackJsonprouter-tutorial"]=this["webpackJsonprouter-tutorial"]||[]).push([[0],{15:function(e,s,t){"use strict";t.r(s);var c=t(1),a=t.n(c),n=t(9),l=t.n(n),r=t(2),i=t(5),d=t(3),j=t(0),o=Object(c.createContext)();function b(){return Object(c.useContext)(o)}function m(e){var s=e.children,t=Object(c.useState)(),a=Object(d.a)(t,2),n=a[0],l=a[1];return Object(j.jsx)(o.Provider,{value:{user:n,signIn:function(e,s,t){var c=JSON.stringify({email:e,pin:s}),a=new Request("api/login",{method:"POST",body:c,headers:{"Content-Type":"application/json"}});fetch(a).then((function(e){e.status>=200&&e.status<500?e.json().then((function(s){l(e.ok?s:null),t(e.ok?null:s)}),(function(e){console.log(e)})).catch((function(e){console.log(e)})):e.text().then((function(e){l(null),t()}))}))},signOut:function(e,s){var t=new Request("/api/logout",{method:"POST",body:JSON.stringify({email:e})});fetch(t).then((function(e){l(null),s()}))}},children:s})}function h(){var e,s=b(),t=Object(r.h)();return Object(j.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("h1",{children:Object(j.jsx)(i.b,{className:"navbar-brand",to:"/dashboard/summary",children:"Smart Water Level Controller"})}),Object(j.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:[Object(j.jsx)("ul",{className:"d-flex navbar-nav me-auto mb-2 mb-lg-0"}),Object(j.jsx)("div",{className:"nav-item dropdown d-flex",children:Object(j.jsxs)("div",{className:"nav-item dropdown",children:[Object(j.jsx)("button",{className:"btn btn-secondary btn-sm dropdown-toggle",id:"navbarDropdown","data-bs-toggle":"dropdown","aria-expanded":"false",children:null===(e=s.user)||void 0===e?void 0:e.fullName}),Object(j.jsx)("ul",{className:"dropdown-menu","aria-labelledby":"navbarDropdown",children:Object(j.jsx)("li",{children:Object(j.jsx)("button",{className:"dropdown-item",onClick:function(){var e;s.signOut(null===(e=s.user)||void 0===e?void 0:e.email,(function(){t("/login",{replace:!0})}))},children:"Logout"})})})]})})]})]})})}function u(){var e=Object(r.g)(),s=Object(r.h)();function t(s){return e.pathname.endsWith(s)?"list-group-item active":"list-group-item"}return Object(c.useEffect)((function(){"/"===e.pathname&&s("/dashboard/summary",{replace:!0})}),[e,s]),Object(j.jsxs)("div",{className:"card shadow",style:{width:"18rem"},children:[Object(j.jsx)("div",{className:"card-header",children:Object(j.jsx)("h5",{className:"card-title",children:"Dashboard"})}),Object(j.jsx)("div",{className:"card-body",children:Object(j.jsxs)("ul",{className:"list-group list-group-flush",children:[Object(j.jsx)(i.b,{to:"/dashboard/summary",className:t("/dashboard/summary"),children:"Summary"}),Object(j.jsx)(i.b,{to:"/dashboard/usage",className:t("/dashboard/usage"),children:"Usage"})]})}),Object(j.jsx)("div",{className:"card-header",style:{borderTop:"1px solid rgba(0,0,0,.125)"},children:Object(j.jsx)("h5",{className:"card-title",style:{marginTop:"10px"},children:"Schedules"})}),Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("ul",{className:"list-group list-group-flush",children:Object(j.jsx)(i.b,{to:"/schedules/current",className:t("/schedules/current"),children:"Water Pump"})})}),Object(j.jsx)("div",{className:"card-header",style:{borderTop:"1px solid rgba(0,0,0,.125)"},children:Object(j.jsx)("h5",{className:"card-title",style:{marginTop:"10px"},children:"Notifications"})}),Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("ul",{className:"list-group list-group-flush",children:Object(j.jsx)(i.b,{to:"/alerts/active",className:t("/alerts/active"),children:"Active"})})})]})}var O=function(){return Object(j.jsxs)("div",{style:{height:"100%"},children:[Object(j.jsx)(h,{}),Object(j.jsx)("div",{className:"container",children:Object(j.jsxs)("div",{className:"row",style:{marginTop:"10px"},children:[Object(j.jsx)("div",{className:"col-3",children:Object(j.jsx)(u,{})}),Object(j.jsx)("div",{className:"col",children:Object(j.jsx)(r.b,{})})]})})]})},x=!1;var p=function(){var e,s,t=Object(r.h)(),a=Object(r.g)(),n=b(),l=Object(c.useState)(!1),i=Object(d.a)(l,2),o=i[0],m=i[1],h=Object(c.useState)(!1),u=Object(d.a)(h,2),O=u[0],p=u[1],v=(null===(e=a.state)||void 0===e||null===(s=e.from)||void 0===s?void 0:s.pathname)||"/";return Object(c.useEffect)((function(){return n.user||o||x?m(!0):(x=!0,fetch("/api/session").then((function(e){200===e.status?e.json().then((function(e){n.user=e,t("/",{replace:!0})})):m(!0)}))),function(){m(!0)}}),[o,n,t]),o&&!n.user?Object(j.jsx)("div",{className:"container vh-100",children:Object(j.jsxs)("div",{className:"row align-items-center vh-100",children:[Object(j.jsx)("div",{className:"col"}),Object(j.jsx)("div",{className:"col",children:Object(j.jsxs)("form",{onSubmit:function(e){e.preventDefault(),p(!0);var s=new FormData(e.currentTarget),c=s.get("email"),a=s.get("pin");n.signIn(c,a,(function(e){e?(p(!1),console.log(e)):t(v,{replace:!0})}))},children:[Object(j.jsx)("h3",{children:"Sign in"}),Object(j.jsxs)("div",{className:"form-floating mb-3",children:[Object(j.jsx)("input",{name:"email",type:"email",className:"form-control",id:"floatingInput",placeholder:"name@example.com",required:!0}),Object(j.jsx)("label",{htmlFor:"floatingInput",children:"Email address"})]}),Object(j.jsxs)("div",{className:"form-floating",children:[Object(j.jsx)("input",{name:"pin",type:"password",className:"form-control",id:"floatingPassword",placeholder:"Pin",required:!0}),Object(j.jsx)("label",{htmlFor:"floatingPassword",children:"Pin"})]}),Object(j.jsxs)("button",{type:"submit",className:"btn btn-primary",style:{marginTop:"10px"},disabled:O,children:[O&&Object(j.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),O&&" Sign in",!O&&"Sign in"]}),Object(j.jsxs)("div",{className:"form-text",children:["Not registered? ",Object(j.jsx)("a",{href:"/register",className:"link-primary",children:"Register here"})]})]})}),Object(j.jsx)("div",{className:"col"})]})}):Object(j.jsx)("div",{})};function v(e){var s=e.children,t=Object(c.useState)(!1),a=Object(d.a)(t,2),n=a[0],l=a[1],i=b(),o=Object(r.g)();return Object(c.useEffect)((function(){return i.user||n||fetch("/api/session").then((function(e){200===e.status?e.json().then((function(e){i.user=e,l(!0)})):l(!0)})),function(){l(!0)}}),[n,i]),i.user?s:n?Object(j.jsx)(r.a,{to:"/login",state:{from:o}}):Object(j.jsx)("div",{})}var f=t(6),N=t.n(f);function g(){var e=b(),s=Object(c.useState)(),t=Object(d.a)(s,2),a=t[0],n=t[1],l=Object(r.h)();return Object(c.useEffect)((function(){if(!a){var e=sessionStorage.getItem("wlgwStatus");e?n(JSON.parse(e)):fetch("/api/status").then((function(e){e.status>=200&&e.status<400?e.json().then((function(e){n(e),sessionStorage.setItem("wlgwStatus",JSON.stringify(e))})):e.text().then((function(e){console.log(e)}))}))}}),[a,e,l]),Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Summary"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page a brief summary of various components of the water management system in your apartment."}),!a&&Object(j.jsx)("p",{className:"fw-normal",children:"Please wait while we fetch latest water levels in your aparment..."}),!a&&Object(j.jsx)("div",{className:"d-flex justify-content-center",children:Object(j.jsx)("div",{className:"spinner-border m-5",role:"status",style:{width:"3rem",height:"3rem"}})}),a&&Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0 h-100",children:[Object(j.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center",children:Object(j.jsx)("i",{className:"bi bi-water",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Overhead Tank"}),Object(j.jsxs)("p",{className:"card-text",children:["The overhead water tank has ",Object(j.jsx)("span",{className:"fw-bold",children:a.wlgw.volume})," liters of water."]}),Object(j.jsx)("p",{className:"card-text",children:Object(j.jsxs)("small",{className:"text-muted",children:["Last updated ",N()(new Date(a.wlgw.timestamp))]})})]})})]})})})}),a&&Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0 h-100",children:[Object(j.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center",children:Object(j.jsx)("i",{className:"bi bi-moisture",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Sump Tank"}),Object(j.jsxs)("p",{className:"card-text",children:["The sump tank has ",Object(j.jsx)("span",{className:"fw-bold",children:a.wlgw.volume})," liters of water."]}),Object(j.jsx)("p",{className:"card-text",children:Object(j.jsxs)("small",{className:"text-muted",children:["Last updated ",N()(new Date(a.wlgw.timestamp))]})})]})})]})})})})]})}function w(){return Object(j.jsx)("h1",{children:"Usage"})}function y(){var e=Object(c.useState)({startsOn:{minLevel:600},endsOn:{maxLevel:1500},lastUpdatedOn:new Date(1636494845e3)}),s=Object(d.a)(e,1)[0];return Object(j.jsxs)("div",{children:[Object(j.jsx)("h3",{children:"Water pump schedule"}),Object(j.jsx)("p",{className:"fw-normal",children:"This page shows the current schedule of your water pumping system."}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-8",children:Object(j.jsx)("div",{className:"card mb-3 top-m-5",children:Object(j.jsxs)("div",{className:"row g-0",children:[Object(j.jsx)("div",{className:"col-md-4 bg-secondary",children:Object(j.jsx)("div",{className:"img-fluid rounded-start d-flex align-items-center justify-content-center h-100",children:Object(j.jsx)("i",{className:"bi bi-calendar2-date-fill",style:{fontSize:"07rem",color:"cornflowerblue"}})})}),Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title",children:"Pump timings"}),"Current schedule of your water pump is as follows:",Object(j.jsx)("p",{}),Object(j.jsx)("h6",{children:"Turns on"}),Object(j.jsxs)("p",{className:"card-text",children:["Whenever water level drops below\xa0",Object(j.jsx)("span",{className:"fw-bold",children:s.startsOn.minLevel})," liters."]}),Object(j.jsx)("h6",{children:"Turns off"}),Object(j.jsxs)("p",{className:"card-text",children:["Whenever water level reaches\xa0",Object(j.jsx)("span",{className:"fw-bold",children:s.endsOn.maxLevel})," liters."]}),Object(j.jsx)("p",{className:"card-text",children:Object(j.jsxs)("small",{className:"text-muted",children:["Updated ",N()(s.lastUpdatedOn)]})})]})})]})})}),Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"d-flex col-8 justify-content-end gx-0",children:Object(j.jsx)("div",{children:Object(j.jsx)("button",{className:"btn btn-primary bg-lt",children:"Change schedule"})})})})]})]})}function S(){return Object(j.jsx)("h1",{children:"Active notifications"})}l.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(m,{children:Object(j.jsx)(i.a,{children:Object(j.jsxs)(r.e,{children:[Object(j.jsx)(r.c,{path:"/login",element:Object(j.jsx)(p,{})}),Object(j.jsxs)(r.c,{path:"/",element:Object(j.jsx)(v,{children:Object(j.jsx)(O,{})}),children:[Object(j.jsx)(r.c,{path:"/dashboard/summary",element:Object(j.jsx)(v,{children:Object(j.jsx)(g,{})})}),Object(j.jsx)(r.c,{path:"/dashboard/usage",element:Object(j.jsx)(v,{children:Object(j.jsx)(w,{})})}),Object(j.jsx)(r.c,{path:"/schedules/current",element:Object(j.jsx)(v,{children:Object(j.jsx)(y,{})})}),Object(j.jsx)(r.c,{path:"/alerts/active",element:Object(j.jsx)(v,{children:Object(j.jsx)(S,{})})})]})]})})})}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.1b864acc.chunk.js.map